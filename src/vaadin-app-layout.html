<!--
@license
Vaadin App Layout
Copyright (C) 2018 Vaadin Ltd
This program is available under Commercial Vaadin Add-On License 3.0 (CVALv3).
See the file LICENSE.md distributed with this software for more information about licensing.
See <a href="https://vaadin.com/license/cval-3">the website</a> for the complete license.
-->

<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../../vaadin-element-mixin/vaadin-element-mixin.html">
<link rel="import" href="../../vaadin-license-checker/vaadin-license-checker.html">

<dom-module id="vaadin-app-layout">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column-reverse;
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        position: fixed;
        bottom: var(--vaadin-app-layout-viewport-bottom);
        /* CSS API for host */
        --vaadin-app-layout-viewport-bottom: 0;
        --vaadin-app-layout-navbar-height: 50px;
      }

      :host([hidden]) {
        display: none !important;
      }

      [part="branding"] {
        display: none;
      }

      [part="navbar"] {
        flex: none;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      [part="branding"],
      [part="navbar"] {
        height: var(--vaadin-app-layout-navbar-height);
      }

      [part="menu"] {
        width: auto;
        overflow: hidden;
        max-width: 100%;
      }

      [part="content"] {
        flex: auto;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      @media (min-width: 700px) {
        :host {
          flex-direction: column;
        }

        [part="menu"] {
          max-width: 60%;
        }

        [part="branding"] {
          display: flex;
          position: absolute;
          top: 0;
          left: 0;
          max-width: 20%;
          max-height: 100%;
          align-items: center;
        }

        [part="branding"] ::slotted(*) {
          max-width: 100%;
          max-height: 100%;
        }
      }
    </style>

    <div part="navbar" role="navigation">
      <div part="branding" role="banner">
        <slot name="branding"></slot>
      </div>
      <div part="menu" role="menu">
        <slot name="menu"></slot>
      </div>
      <div part="secondary">
        <slot name="secondary"></slot>
      </div>
    </div>
    <div part="content" role="main">
      <slot></slot>
    </div>

  </template>

  <script>
    (function() {

      /**
       * `<vaadin-app-layout>` is a Web Component providing a quick and easy way to get a common application layout structure done.
       *
       * ```
       * <vaadin-app-layout>
       *  <h3 slot="branding">Company Name</h3>
       *  <vaadin-tabs slot="menu">
       *    <vaadin-tab>Menu item</vaadin-tab>
       *  </vaadin-tabs>
       *  <div>Page content</div>
       * </vaadin-app-layout>
       * ```
       *
       * ### Styling
       *
       * The following Shadow DOM parts of the `<vaadin-app-layout>` are available for styling:
       *
       * Part name     | Description
       * --------------|---------------------------------------------------------|
       * `navbar`      | Container for the navigation bar
       * `branding`    | Placeholder for the logo or for the app name. By default is invisible on small screens
       * `menu`        | Container for an app menu. Placed in the middle of navigation bar.
       * `content`     | Container for page content.
       *
       * The following custom CSS properties are available for styling:
       *
       * Custom CSS property | Description | Default value
       * ---|---|---
       * `--vaadin-app-layout-viewport-bottom` | Bottom offset of the visible viewport area | `0` or detected offset
       * `--vaadin-app-layout-navbar-height` | Height of the navigation bar and branding inside | `50px`
       *
       * See [ThemableMixin â€“ how to apply styles for shadow parts](https://github.com/vaadin/vaadin-themable-mixin/wiki)
       *
       * ### Component's slots
       *
       * The following slots are available to be set
       *
       * Slot name     | Description
       * --------------|---------------------------------------------------|
       * no name       | Default placeholder for the page content
       * `branding`    | Placeholder for the logo or application name
       * `menu`        | Placeholder for an application menu
       *
       * See examples of setting the content into slots in the live demos.
       *
       * @memberof Vaadin
       * @mixes Vaadin.ElementMixin
       * @mixes Vaadin.ThemableMixin
       * @demo demo/index.html
       */
      class AppLayoutElement extends Vaadin.ElementMixin(Vaadin.ThemableMixin(Polymer.Element)) {
        static get is() {
          return 'vaadin-app-layout';
        }
        static get version() {
          return '1.0.0-alpha1';
        }

        constructor() {
          super();

          if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            this._boundIosResizeListener = () => this._detectIosNavbar();
          }
        }

        connectedCallback() {
          super.connectedCallback();
          if (this._boundIosResizeListener) {
            this._detectIosNavbar();
            window.addEventListener('resize', this._boundIosResizeListener);
          }
        }

        _detectIosNavbar() {
          const innerHeight = window.innerHeight;
          const innerWidth = window.innerWidth;
          const landscape = innerWidth > innerHeight;
          const clientHeight = document.documentElement.clientHeight;
          if (landscape && clientHeight > innerHeight) {
            this.style.setProperty('--vaadin-app-layout-viewport-bottom', clientHeight - innerHeight + 'px');
          } else {
            this.style.setProperty('--vaadin-app-layout-viewport-bottom', '0');
          }
        }
      }

      customElements.define(AppLayoutElement.is, AppLayoutElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.AppLayoutElement = AppLayoutElement;

      const licenseChecker = window.Vaadin.developmentModeCallback
        && window.Vaadin.developmentModeCallback['vaadin-license-checker'];
      if (typeof licenseChecker === 'function') {
        licenseChecker(AppLayoutElement);
      }
    })();
  </script>
</dom-module>
