<!--
@license
Copyright (c) 2018 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../../vaadin-element-mixin/vaadin-element-mixin.html">

<dom-module id="vaadin-app-layout">
  <template>
    <style>
      :host {
        display: block;
        height: 100%;
        position: fixed;
        bottom: var(--vaadin-app-layout-viewport-bottom);
        /* CSS API for host */
        --vaadin-overlay-viewport-bottom: 0;
      }

      :host([hidden]) {
        display: none !important;
      }
    </style>
    
    <div id="container" part="container">
      <div part="navbar">
        <div part="branding">
          <slot name="branding"></slot>
        </div>
        <div part="menu">
          <slot name="menu"></slot>
        </div>
      </div>
      <div id="content" part="content">
        <slot></slot>
      </div>
    </div>

  </template>

  <script>
    (function() {

      /**
       * `<vaadin-app-layout>` is a Polymer 2 element.
       *
       * ```
       * <vaadin-app-layout></vaadin-app-layout>
       * ```
       *
       * @memberof Vaadin
       * @demo demo/index.html
       */
      class AppLayoutElement extends Vaadin.ElementMixin(Vaadin.ThemableMixin(Polymer.Element)) {
        static get is() {
          return 'vaadin-app-layout';
        }
        static get version() {
          return '0.1.0';
        }

        constructor() {
          super();

          if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            this._boundIosResizeListener = () => this._detectIosNavbar();
          }
        }

        connectedCallback() {
          super.connectedCallback();
          if (this._boundIosResizeListener) {
            this._detectIosNavbar();
            window.addEventListener('resize', this._boundIosResizeListener);
          }
        }

        _detectIosNavbar() {
          const innerHeight = window.innerHeight;
          const innerWidth = window.innerWidth;
          const landscape = innerWidth > innerHeight;
          const clientHeight = document.documentElement.clientHeight;
          if (landscape && clientHeight > innerHeight) {
            this.style.setProperty('--vaadin-app-layout-viewport-bottom', clientHeight - innerHeight + 'px');
          } else {
            this.style.setProperty('--vaadin-app-layout-viewport-bottom', '0');
          }
        }
      }

      customElements.define(AppLayoutElement.is, AppLayoutElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.AppLayoutElement = AppLayoutElement;
      if (window.Vaadin.runIfDevelopmentMode) {
        window.Vaadin.runIfDevelopmentMode('vaadin-license-checker', AppLayoutElement);
      }
    })();
  </script>
</dom-module>
