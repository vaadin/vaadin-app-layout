<!--
@license
Vaadin Navbar Layout
Copyright (C) 2019 Vaadin Ltd
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="vaadin-app-layout-base.html">

<dom-module id="vaadin-navbar-layout-style">
  <template>
    <style>
      [offset-element] ::slotted(vaadin-navbar) {
        padding-top: calc(var(--vaadin-navbar-padding-block-start) + constant(safe-area-inset-top));
        padding-top: calc(var(--vaadin-navbar-padding-block-start) + env(safe-area-inset-top));
        padding-left: calc(var(--vaadin-navbar-padding-inline-start) + constant(safe-area-inset-left));
        padding-left: calc(var(--vaadin-navbar-padding-inline-start) + env(safe-area-inset-left));
        padding-right: calc(var(--vaadin-navbar-padding-inline-end) + constant(safe-area-inset-right));
        padding-right: calc(var(--vaadin-navbar-padding-inline-end) + env(safe-area-inset-right));
      }
    </style>
  </template>
</dom-module>

<dom-module id="vaadin-navbar-layout">
  <script>
    (function() {

      /**
       *
       * @memberof Vaadin
       * @extends Vaadin.AppLayoutBaseElement
       * @demo demo/index.html
       */
      class NavbarLayoutElement extends Vaadin.AppLayoutBaseElement {
        static get is() {
          return 'vaadin-navbar-layout';
        }

        static get version() {
          return '1.0.0';
        }

        static get template() {
          return this._modifiedTemplate('navbar');
        }

        /** @private */
        connectedCallback() {
          super.connectedCallback();
          this.shadowRoot.addEventListener('slotchange', this.__boundSlotChangeListener);
        }

        /** @protected */
        _getOffsetValues() {
          const navbar = this.querySelector('vaadin-navbar');

          let bottomMenu = false;
          if (navbar && this.orientation == "vertical") {
            bottomMenu = getComputedStyle(navbar).getPropertyValue('--vaadin-navbar-bottom-menu').trim().toLowerCase() == 'true';
            if (bottomMenu) {
              navbar.setAttribute('bottom-menu', '');
            } else if (navbar) {
              navbar.removeAttribute('bottom-menu');
            }
          }

          const offset = super._getOffsetValues();

          if(bottomMenu) {
            const menu = navbar.shadowRoot.querySelector('[part="menu"]');
            offset.bottom = menu.offsetHeight;
          }

          return offset;
        }
      }

      customElements.define(NavbarLayoutElement.is, NavbarLayoutElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.NavbarLayoutElement = NavbarLayoutElement;
    })();
  </script>
</dom-module>
