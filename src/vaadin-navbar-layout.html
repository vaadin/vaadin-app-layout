<!--
@license
Vaadin Navbar Layout
Copyright (C) 2019 Vaadin Ltd
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="vaadin-app-layout-base.html">

<dom-module id="vaadin-navbar-layout-style">
  <template>
    <style>
      :host([orientation^="vertical"]) [offset-element] {
        left: var(--vaadin-drawer-layout-offset, 0);
      }

      :host([orientation="vertical"]) {
        padding-top: var(--vaadin-navbar-layout-offset);
      }

      :host([orientation="vertical-reverse"]) {
        padding-bottom: var(--vaadin-navbar-layout-offset);
      }

      :host([orientation="horizontal"]) {
        padding-left: var(--vaadin-navbar-layout-offset);
      }

      :host([orientation="horizontal-reverse"]) {
        padding-right: var(--vaadin-navbar-layout-offset);
      }
    </style>
  </template>
</dom-module>

<dom-module id="vaadin-navbar-layout">
  <script>
    (function() {

      /**
       *
       * @memberof Vaadin
       * @extends Vaadin.AppLayoutBaseElement
       * @demo demo/index.html
       */
      class NavbarLayoutElement extends Vaadin.AppLayoutBaseElement {
        static get is() {
          return 'vaadin-navbar-layout';
        }

        static get version() {
          return '1.0.0';
        }

        static get template() {
          return this._modifiedTemplate('navbar');
        }

        _updateOffsetSize(animate) {
          super._updateOffsetSize(animate);

          this._updateNavbarMenu();

          const navbar = this.querySelector('vaadin-navbar');
          if (navbar && this._isBottomMenu()) {
            const menu = navbar.shadowRoot.querySelector('[part="menu"]');
            this.style.setProperty('--vaadin-navbar-layout-offset-bottom', menu.getBoundingClientRect().height + 'px');
          } else {
            this.style.setProperty('--vaadin-navbar-layout-offset-bottom', '');
          }
        }

        _updateNavbarMenu() {
          const navbar = this.querySelector('vaadin-navbar');

          if (this._isBottomMenu()) {
            navbar.setAttribute('bottom-menu', '');

            if (this.fixed) {
              navbar.setAttribute('fixed', '');
            } else {
              navbar.removeAttribute('fixed');
            }
          } else if (navbar) {
            navbar.removeAttribute('bottom-menu');
            navbar.removeAttribute('fixed');
          }
        }

        _isBottomMenu() {
          if (this.orientation == 'vertical') {
            const navbar = this.querySelector('vaadin-navbar');
            return navbar && getComputedStyle(navbar).getPropertyValue('--vaadin-navbar-bottom-menu').trim().toLowerCase() == 'true';
          }
          return false;
        }

        _resize() {
          super._resize();
          this._updateNavbarMenu();
        }
      }

      customElements.define(NavbarLayoutElement.is, NavbarLayoutElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.NavbarLayoutElement = NavbarLayoutElement;
    })();
  </script>
</dom-module>
