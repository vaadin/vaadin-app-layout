<!--
@license
Vaadin Drawer Toggle
Copyright (C) 2018 Vaadin Ltd
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../../vaadin-button/vaadin-button.html">
<link rel="import" href="../../vaadin-lumo-styles/icons.html">
<link rel="import" href="../../iron-icon/iron-icon.html">

<dom-module id="vaadin-drawer-toggle">
  <template>
    <style>
      :host {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: default;
        position: relative;
        outline: none;
      }

      #button {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: inherit;
      }
    </style>
    <slot>
      <!-- TODO(jouni): don't use Lumo in the core styles, and make this customizable (font-icon) -->
      <iron-icon icon="lumo:menu"></iron-icon>
    </slot>
    <button id="button" type="button"></button>
  </template>

  <script>
    (function() {

      /**
       * The Drawer Toggle component controls a Drawer Layout component.
       *
       * ```
       * <vaadin-drawer-toggle for="layout">Toggle drawer</vaadin-drawer-toggle>
       * <vaadin-drawer-layout id="layout"></vaadin-drawer-layout>
       * ```
       *
       * @memberof Vaadin
       * @extends Vaadin.ButtonElement
       * @demo demo/index.html
       */
      class DrawerToggleElement extends Vaadin.ButtonElement {
        static get is() {
          return 'vaadin-drawer-toggle';
        }

        static get version() {
          return '1.0.0';
        }

        constructor() {
          super();

          this.addEventListener('click', e => {
            if (this._target) {
              this._target.opened = !this._target.opened;

              if (this._target.opened) {
                this.setAttribute('opened', '');
              } else {
                this.removeAttribute('opened');
              }
            }
            this.dispatchEvent(new CustomEvent('drawer-toggle-click', {bubbles: true, composed: true}));
          });
        }

        connectedCallback() {
          super.connectedCallback();
          this._findTarget();
        }

        _findTarget() {
          let root = this.getRootNode();
          if (root == document) {
            // Avoid matching elements in the <head> that come through the HTML Imports polyfill
            root = document.body;
          }

          // Find the target <vaadin-drawer-layout>
          if (this.hasAttribute('for')) {
            this._target = root.querySelector('#' + this.getAttribute('for'));
          } else {
            // Find the first drawer-layout in the same DOM scope as the toggle
            this._target = root.querySelector('vaadin-drawer-layout');
          }
        }
      }

      customElements.define(DrawerToggleElement.is, DrawerToggleElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.DrawerToggleElement = DrawerToggleElement;
    })();
  </script>
</dom-module>
